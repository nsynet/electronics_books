#include <iom16v.h> 
#define uchar unsigned char 
#define uint unsigned int
uchar duan[10]={0x3f,0x06,0x5b,0x4f,0x66,0x6d,0x7d,0x07,0x7f,0x6f};	 //ËùĞèµÄ¶ÎµÄÎ»Âë
//uchar wei[4]={0XFE,0XFD,0XFB,0XF7}; //Î»µÄ¿ØÖÆ¶Ë	(¿ª·¢°å)
uchar wei[4]={0X0e,0X0d,0X0b,0X07};   //Î»µÄ¿ØÖÆ¶Ë	(·ÂÕæ)
uchar Key1_Flag,Key2_Flag,Key3_Flag;  //°´¼ü¿ØÖÆÆµÂÊ¼Ó¼õ¸´Î»                          
uint z,x,c,v, date;	//¶¨ÒåÊı¾İÀàĞÍ
uint date=1;        //ÆµÂÊ³õÊ¼Öµ1K
/******************************************************************
ÑÓÊ±º¯Êı
******************************************************************/
void delay(uchar t)
{
  uchar i,j;
   for(i=0;i<t;i++)
   {
   	 for(j=13;j>0;j--);
	 { ; }
   }
}
/**********************************************************************
                ÊıÂë¹Ü¶¯Ì¬É¨Ãè
*********************************************************************/
void xianshi()
 { 
 uint i,j;
 /*************************Êı¾İ×ª»»*****************************/ 
  z=date/1000;			 //ÇóÇ§Î»
  x=date%1000/100;		 //Çó°ÙÎ»
  c=date%100/10;		 //ÇóÊ®Î»
  v=date%10;			 //Çó¸öÎ»
 /*****************ÉèÖÃ±È½Ï¼Ä´æÆ÷Öµ*****************************/ 
 i=z*1000+x*100+c*10+v;
 j=500/i;
 OCR1AH=j>>8;
 OCR1AL=j&0x00ff;
 /********************ÊıÂë¹ÜÉ¨ÃèÏÔÊ¾****************************/ 

      PORTC=wei[0];
	  PORTA=duan[z];
	  delay(50);  
  	  PORTC=wei[1];
      PORTA=duan[x];
	  delay(50);  
   	  PORTC=wei[2];
      PORTA=duan[c];
	  delay(50);  
      PORTC=wei[3];
      PORTA=duan[v];
	  delay(50);  
 	}
/**********************************************************************
                          ÆµÂÊµ÷½Ú°´¼ü¿ØÖÆ
*********************************************************************/
void Key_Process()
{
 while((PINB&0x01)==0) {xianshi();Key1_Flag=1;}
 while((PINB&0x02)==0) {xianshi();Key2_Flag=1;}
 while((PINB&0x04)==0) {xianshi();Key3_Flag=1;}
 if(Key1_Flag==1) //´¦ÀíÆµÂÊ°ÙÎ»£¬×î¸ß4
   {
    date++;//ÉèÖÃÆµÂÊÖµ¼Ó
	if(date>=30) date=30;//ÉèÖÃ×î´óÖµÎª30KHZ
	Key1_Flag=0;
	}   
 if(Key2_Flag==1) //´¦ÀíÆµÂÊÊ®Î»£¬×î¸ß9
    {
	if(date<=0) date=1;  //ÉèÖÃ×î´óÖµÎª0HZ
	date--;//ÉèÖÃÆµÂÊÖµ¼õ
	Key2_Flag=0;
	 }
 if(Key3_Flag==1) //´¦ÀíÆµÂÊ¸÷Î»£¬×î¸ß9
    {
	date=1;//ÉèÖÃÆµÂÊ¸´Î»
	Key3_Flag=0;
	 }
}
/******************************************************************

/**********************************************************************
                         ³õÊ¼»¯I/O¿Ú
*********************************************************************/
void Init_IO(void)             //³õÊ¼»¯I/O¿Ú
{DDRA=0xff;                    //ÉèÖÃA¿ÚÎªÍÆÍì1Êä³ö
 PORTA=0xff;
 DDRC=0xff;                    //ÉèÖÃC¿ÚÎªÍÆÍì1Êä³ö             
 PORTC=0xff;
 DDRB=0x00;                    //ÉèÖÃB¿ÚÎªÈıÌ¬ÊäÈë
 PORTB=0x00;
 DDRD=0xff;                    //ÉèÖÃD¿ÚÎªÍÆÍì1Êä³ö
 PORTD=0xff;    
}
/**********************************************************************
                         ³õÊ¼»¯I/O¿Ú
*********************************************************************/
void Init_Timer1(void)         //³õÊ¼»¯T/C1µÄÊäÈë²¶»ñÖĞ¶Ï
{TIMSK=TIMSK|0x10;             //Êä³ö±È½ÏÊ¹ÄÜ
 TCCR1B=0x0a;                  //Ê±ÖÓ1Æµ,Êä³ö±È½ÏÆ¥ÅäÇå³ı¶¨Ê±Æ÷Öµ
 TCNT1H=0x00;                  //Çå³ı¶¨Ê±Æ÷Öµ
 TCNT1L=0x00;
 SREG=SREG|0x80;               //È«¾ÖÖĞ¶Ï¿ª
} 
/**********************************************************************
                          Ö÷º¯Êı
*********************************************************************/
void main(void)
{
 Init_IO(); //³õÊ¼»¯I/O¿Ú
 xianshi(); //ÏÔÊ¾³õÊ¼Öµ
 Init_Timer1();//³õÊ¼»¯T/C1µÄÊäÈë²¶»ñÖĞ¶Ï 
 
 while(1)
 {

Key_Process();//°´¼üÖµº¯Êı
xianshi();//ÆµÂÊÖµÏÔÊ¾

 }
}
/**********************************************************************
                          ÖĞ¶Ï·şÎñº¯Êı
*********************************************************************/
#pragma interrupt_handler Compare:7
void Compare(void)
{
PORTD=~PORTD;¡//PD¿ÚÊä³ö
}