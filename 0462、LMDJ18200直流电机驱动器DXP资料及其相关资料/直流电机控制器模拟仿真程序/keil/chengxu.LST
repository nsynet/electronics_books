C51 COMPILER V8.05a   CHENGXU                                                              06/20/2009 00:36:05 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE CHENGXU
OBJECT MODULE PLACED IN chengxu.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE chengxu.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          #include <reg52.h>             //头文件
   3          #define uchar unsigned char        //宏定义无符号字符型
   4          #define uint  unsigned  int        //宏定义无符号整型
   5          
   6          uchar b;                //中断值
   7          uchar N=0;              //占空比计数值
   8          uchar X=50;             //占空比初始值
   9          
  10          uchar key_up;
  11          uchar key_down;
  12          /************************************************************************
  13                                                                  按键初始化
  14          *************************************************************************/
  15          sbit P2_0=P2^0;//正转
  16          sbit P2_1=P2^1;//反转
  17          sbit P2_2=P2^2;//加速
  18          sbit P2_3=P2^3;//减速
  19          sbit P2_4=P2^4;//停止
  20          
  21          sbit P1_0=P1^0;//输出控制方向（高电平为电机正转/低电平为电机反转）
  22          sbit P1_1=P1^1;//输出控制刹车（高电平为电机运行/低电平为电机停止）
  23          
  24          
  25          sbit PWMA=P3^7;//控制PWM输出 （利用脉宽控制电机的转速）
  26          /************************************************************************
  27                                                                  调速按键扫描函数
  28          *************************************************************************/
  29          void get_key(void)//按键扫描函数
  30          
  31          {
  32   1      while(P2_2==0)//按键加计数标志
  33   1      {key_up=1;
  34   2      }
  35   1      while(P2_3==0)//按键减计数标志
  36   1      {key_down=1;
  37   2      }
  38   1      }
  39          /************************************************************************
  40                                                                  定时器中断执行函数
  41          *************************************************************************/
  42          void timer0( ) interrupt 1 //定时器0工作方式1
  43          {
  44   1      
  45   1      TH0=(65536-1)/256;        //重装计数初值
  46   1      TL0=(65536-1)%256;        //重装计数初值
  47   1      b++;
  48   1      get_key();
  49   1       if (key_up==1)
  50   1             {
  51   2                 if(X!=100)//判断是否计数到9999
  52   2                    {
  53   3                     X=X+2;//加一
  54   3                     key_up=0;
  55   3                                 }
C51 COMPILER V8.05a   CHENGXU                                                              06/20/2009 00:36:05 PAGE 2   

  56   2              }
  57   1      if (key_down==1)
  58   1             {
  59   2                  if(X!=0)//判断是否计数到0
  60   2                    {
  61   3                         X=X-2;//减一
  62   3                     key_down=0;
  63   3                     }
  64   2              }
  65   1      }
  66          
  67          /************************************************************************
  68                                                                  程序主函数
  69          *************************************************************************/
  70          void main()
  71          { 
  72   1      TMOD=0X01;                        //定时器中断0
  73   1      TH0=(65536-2)/256;        //定时时间高八位初值
  74   1      TL0=(65536-2)%256;        //定时时间低八位初值
  75   1      EA=1;                             //开CPU中断
  76   1      ET0=1;                            //开T/C0中断
  77   1      TR0=1;
  78   1      /****************************PWM处理部分*********************************************/
  79   1       while(1)                          //无限循环
  80   1              {
  81   2                PWMA=1;                  //输出PWM正
  82   2       while(1)
  83   2       {
  84   3       b=0;
  85   3       while(!b);
  86   3       if (N==X)
  87   3       PWMA=0;
  88   3       if (N==100)break;
  89   3       N++;
  90   3      /*****************************电机按键控制部分****************************************/
  91   3      while(P2_0==0)//按键加计数标志
  92   3      {
  93   4      P1_0=0;//输出控制方向（高电平为电机正转/低电平为电机反转）
  94   4      P1_1=1;//输出控制刹车（高电平为电机运行/低电平为电机停止）
  95   4      }
  96   3      while(P2_1==0)//按键减计数标志
  97   3      {
  98   4      P1_0=1;//输出控制方向（高电平为电机正转/低电平为电机反转）
  99   4      P1_1=1;//输出控制刹车（高电平为电机运行/低电平为电机停止）
 100   4      }
 101   3      while(P2_4==0)//按键减计数标志
 102   3      {
 103   4      P1_1=0;//输出控制刹车（高电平为电机运行/低电平为电机停止）
 104   4      }
 105   3      /*************************************************************************************/          
 106   3                }
 107   2                  N=0;
 108   2                }
 109   1      }
 110          /******************************程序结束************************************************/                                                                                                                  


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    140    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V8.05a   CHENGXU                                                              06/20/2009 00:36:05 PAGE 3   

   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
