C51 COMPILER V8.05a   步_电_                                                             05/26/2009 14:25:10 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE 步_电_
OBJECT MODULE PLACED IN 步进电机.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 步进电机.C BROWSE DEBUG OBJECTEXTEND

line level    source

   1           #include<reg52.h>
   2           #define uchar unsigned char
   3           #define uint unsigned int
   4           
   5           //电机控制专用数据
   6          /*****P1.0=A ;P1.1=B ;P1.2=B' ; P1.3=A'****/ 
   7          
   8          /*******************************正转数组**************************************************/
   9            code uchar runz[8]={
  10                                0x01,0x03,0x02,0x06,0x04,0x0c,0x08,0x09
  11                                                   }; 
  12                                        //两相四线八拍工作方式
  13          /*******************************反转数组**************************************************/
  14            code uchar runf[8]={
  15                               0x09,0x08,0x0c,0x04,0x06,0x02,0x03,0x01
  16                                                   }; 
  17                                         //两相四线八拍工作方式
  18           uchar keycan=0;                //键值
  19           uchar i,j,k,z;
  20           unsigned char receive_count; //用于存储单片机接收发送缓冲寄存器SBUF里面的内容
  21           uchar add_temp=0,rdu_temp=0;//定义加减速的控制值
  22           uchar oper_temp=0;
  23          
  24           int y=10;//定义转动速度，数值越大电机转速越慢反之则快
  25          
  26           sbit P2_0=P2^0;//正转按键
  27           sbit P2_1=P2^1;//反转按键
  28           sbit P2_2=P2^2;//电机加圈
  29           sbit P2_3=P2^3;//电机减圈
  30          
  31           sbit P3_0=P3^0;//正转按键
  32           sbit P3_1=P3^1;//反转按键
  33           sbit P3_2=P3^2;//电机加圈
  34           sbit P3_3=P3^3;//电机减圈
  35          
  36          /***************************************************************************
  37                                         函数声明
  38          ***********************************************************************/
  39           void delay(i) ;
  40           void zrun();
  41           void frun() ;
  42           void Init_Com(void);
  43           
  44           /********************************************************************
  45                                 主程序
  46           *********************************************************************/
  47          main()
  48          {        
  49   1         Init_Com();
  50   1         while(1)
  51   1           {
  52   2       
  53   2                 if ( RI ) //扫描判断是否接收到数据，
  54   2               {
  55   3                  receive_count = SBUF; 
C51 COMPILER V8.05a   步_电_                                                             05/26/2009 14:25:10 PAGE 2   

  56   3                  RI=0; //RI 
  57   3                       //判断串口接收的字符类型
  58   3                  switch( receive_count) 
  59   3                                 {              
  60   4                                       case 'A': keycan=1;break;          //接收到的字符为B 是keycan=1
  61   4                                           case 'B': keycan=2;break;          //接收到的字符为C 是keycan=1
  62   4                                           case 'C': add_temp=1;break;    //接收到的字符为D 是电机加速add_temp=1
  63   4                                           case 'D': rdu_temp=1;break;        //接收到的字符为E是 电机加减速rdu_temp=1
  64   4                                           case 'E': 
  65   4                                                                          keycan=0;
  66   4                                                                              rdu_temp=0;
  67   4                                                                              add_temp=0;
  68   4                                                                              break;     //接收到的字符为F 是keycan=0
  69   4                                  }
  70   3                   }
  71   2             switch (keycan)   //判断电机的工作状态
  72   2                     {
  73   3                                case 0: break;
  74   3                        case 1:
  75   3                                       { 
  76   4                                                  zrun();
  77   4                                                }
  78   3                                                break;
  79   3                        case 2: 
  80   3                                        {
  81   4                                                   frun();
  82   4                                                 }
  83   3                                                 break;
  84   3                       }
  85   2          if(P2_0==0) //如果电机正转按键按下
  86   2            {
  87   3              keycan=1;        //键值等于1
  88   3             }
  89   2          if(P2_1==0) //如果电机反转按键按下
  90   2            {
  91   3              keycan=2;        //键值等于2
  92   3             }
  93   2      
  94   2          if((P2_2==0)||(rdu_temp==1)) //  电机加速
  95   2               {
  96   3                       delay(200);
  97   3                   y=y+2;     
  98   3                          rdu_temp=0;
  99   3                }
 100   2         if((P2_3==0)||(add_temp)) 
 101   2              {       
 102   3                    delay(200);                // 电机减速
 103   3                        y=y-2;
 104   3                        add_temp=0;
 105   3              }
 106   2         }
 107   1      }
 108           
 109          /***************************************************************************************
 110                                串口初始化函数
 111          ***************************************************************************************/
 112          void Init_Com(void)
 113          {
 114   1      TMOD = 0x20;
 115   1      PCON = 0x00;
 116   1      SCON = 0x50;
 117   1      TH1 = 0xFd;
C51 COMPILER V8.05a   步_电_                                                             05/26/2009 14:25:10 PAGE 3   

 118   1      TL1 = 0xFd;
 119   1      TR1 = 1;
 120   1      }
 121          
 122           /********************************************************************
 123                                延时程序
 124           *********************************************************************/          
 125          void delay(i)//延时函数
 126            {
 127   1            for(j=0;j<i;j++)
 128   1            for(k=0;k<150;k++);
 129   1        }
 130          
 131           /********************************************************************
 132                                步进电机正传程序
 133           *********************************************************************/ 
 134          
 135          void zrun()// 正转运行
 136          {  
 137   1      
 138   1                 for(z=0;z<8;z++)
 139   1               {
 140   2                   P1=runz[z];
 141   2                   delay(y);
 142   2               }
 143   1      }
 144           /********************************************************************
 145                                 步进电机反转程序
 146           *********************************************************************/ 
 147          void frun()// 反转运行
 148           {
 149   1                  for(z=0;z<8;z++)
 150   1                {
 151   2                  P1=runf[z];
 152   2                  delay(y);
 153   2                }
 154   1      }
 155           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    243    ----
   CONSTANT SIZE    =     16    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     11    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
