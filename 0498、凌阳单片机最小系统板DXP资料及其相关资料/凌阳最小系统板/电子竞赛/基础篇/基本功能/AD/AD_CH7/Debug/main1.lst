Sunplus u'nSP Assembler - Ver. 1.8.0
              Listing File Has Been Relocated
                            	//*****************************************************************************/
                            	// 描述： 通过7路AD转换，结果存至相应存储单元
                            	//        采用读取P_ADC_MUX_DATA寄存器启动ADC转换。
                            	// 日期： 2003/07/09
                            	// 版本:  1.8.0
                            	//*****************************************************************************/
                            	.DEFINE		P_INT_Ctrl		    0x7010 
                            	.DEFINE		P_INT_CLEAR			0x7011 
                            	.DEFINE		P_ADC_Ctrl		    0x7015 
                            	.DEFINE		P_ADC_MUX_Ctrl		0x702b 
                            	.DEFINE		P_ADC_MUX_DATA		0x702C
                            	.DEFINE		P_DAC_Ctrl		    0x702A 
                            	.DEFINE     P_WATCHDOG_CLEAR    0x7012
00000000                    	.ISRAM		
                            	.PUBLIC		chanal_data           //声明全局变量
                            	chanal_data:
00000000 FF FF FF FF        	   .DW 7 DUP(?)                 //预留7个整型的数据单元
         FF FF FF FF
         FF FF FF FF
         FF FF      
00008026                    	.CODE
                            	.PUBLIC _main
                            	//============================================================================= 
                            	// 函数： main()
                            	// 描述：主函数
                            	//=============================================================================
                            	
                            	_main: 
00008026 53 92              	    R1 = 0x0013                //允许A/D转换,LINE_IN输入
00008027 19 D3 15 70        	    [P_ADC_Ctrl] = R1 
                            	L_Clear:
00008029 40 94              	    R2 = 0x0000                 
0000802A 40 96              	    R3=chanal_data
                            	L_Chanal:
0000802B 47 44              	    CMP R2, 0x0007
0000802C 44 5E              	    JE L_Clear
0000802D 41 04              	    R2+=1                        //通道计数器加1
0000802E 1A D5 2B 70        	    [P_ADC_MUX_Ctrl] = R2
00008030 40 F0 37 80        	    call L_AD
00008032 D3 D2              	    [R3++]=R1             		 //触发A/D重新转换
00008033 41 92              	    R1 = 0x0001
00008034 19 D3 12 70        	    [P_WATCHDOG_CLEAR] = R1      //清看门狗
00008036 4C EE              	    JMP L_Chanal
                            	//*******************************************************************************/
                            	//转换子程序
                            	//*******************************************************************************/   
                            	L_AD: 	 
00008037 11 93 2B 70        	    R1 = [P_ADC_MUX_Ctrl]        //读寄存器[P_ADC_MUX_Ctrl]的B15位
00008039 09 C3 00 80        	    TEST R1,0x8000               //判断是否转换完毕
0000803B 45 5E              	  JZ L_AD                      //否，继续转换    
0000803C 11 93 2C 70        	    R1 = [P_ADC_MUX_DATA]        //是，则读出[P_ADC_MUX_DATA]转换结果 
0000803E 90 9A              	    retf
                            	//*****************************************************************************/
                            	//  main.asm 结束
                            	//*****************************************************************************/	
0 error(s), 0 warning(s).

