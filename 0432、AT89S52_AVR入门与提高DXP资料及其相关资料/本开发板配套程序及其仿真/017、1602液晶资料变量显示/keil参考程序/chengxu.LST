C51 COMPILER V8.05a   CHENGXU                                                              04/17/2010 21:43:50 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE CHENGXU
OBJECT MODULE PLACED IN chengxu.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE chengxu.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /************************************/
   2          /*http://www.ourhc.com                  */
   3          /*1602LCD测试程序                               */
   4          /*目标器件：AT89S51/52/53               */
   5          /*晶振:12MHZ                                    */
   6          /*编译环境：Keil 7.50A                  */
   7          /************************************/
   8          
   9          /*********************************包含头文件********************************/
  10          #include <reg52.h>
  11          #include <intrins.h>
  12          #define uchar unsigned char      
  13          #define uint unsigned int
  14          /*********************************端口定义**********************************/
  15          sbit rs = P1^0; 
  16          sbit rw = P1^1;
  17          sbit ep = P1^2;
  18          sbit P20= P2^0;
  19          sbit P21= P2^1;
  20          sbit P22= P2^2;
  21          uchar x,y;
  22          /********************************显示数据表*********************************/
  23          uchar code dis1[] = {"Input it date: "};
  24          uchar code dis2[] = {'[', ' ', ' ', ' ', ' ', ']', ' ', ' ', ' ', ' '};
  25          uchar code dis3[] = {' ', ']'};
  26          uchar code dis4[] = {'0', '1', '2', '3','4', '5', '6', '7',  '8', '9' };
  27          uchar code dis5[] = {'0', '1', '2', '3','4', '5', '6', '7',  '8', '9' };
  28          /*****************************************************************************
  29          函数功能:LCD延时子程序
  30          入口参数:ms
  31          出口参数:
  32          *****************************************************************************/
  33          void delay(uchar ms)
  34          {                                                       
  35   1              unsigned char i;
  36   1              while(ms--)
  37   1              {
  38   2                      for(i = 0; i< 250; i++)
  39   2                      {
  40   3                              _nop_();
  41   3                              _nop_();
  42   3                              _nop_();
  43   3                              _nop_();
  44   3                      }
  45   2              }
  46   1      }
  47          
  48          /*****************************************************************************
  49          函数功能:测试LCD忙碌状态
  50          入口参数:
  51          出口参数:result
  52          *****************************************************************************/
  53          bit lcd_bz()
  54          {                                                       
  55   1              bit result;
C51 COMPILER V8.05a   CHENGXU                                                              04/17/2010 21:43:50 PAGE 2   

  56   1              rs = 0;
  57   1              rw = 1;
  58   1              ep = 1;
  59   1              _nop_();
  60   1              _nop_();
  61   1              _nop_();
  62   1              _nop_();
  63   1              result = (bit)(P0 & 0x80);
  64   1              ep = 0;
  65   1              return result;  
  66   1      }
  67          
  68          /*****************************************************************************
  69          函数功能:写指令数据到LCD子程序
  70          入口参数:cmd
  71          出口参数:
  72          *****************************************************************************/
  73          void lcd_wcmd(uchar cmd)
  74          {                                               
  75   1              while(lcd_bz());                        //判断LCD是否忙碌
  76   1              rs = 0;
  77   1              rw = 0;
  78   1              ep = 0;
  79   1              _nop_();
  80   1              _nop_();        
  81   1              P0 = cmd;
  82   1              _nop_();
  83   1              _nop_();
  84   1              _nop_();
  85   1              _nop_();
  86   1              ep = 1;
  87   1              _nop_();
  88   1              _nop_();
  89   1              _nop_();
  90   1              _nop_();
  91   1              ep = 0;         
  92   1      }
  93          
  94          /*****************************************************************************
  95          函数功能:设定显示位置子程序
  96          入口参数:pos
  97          出口参数:
  98          *****************************************************************************/
  99          void lcd_pos(uchar pos)
 100          {                                               
 101   1              lcd_wcmd(pos | 0x80);
 102   1      }
 103          
 104          /*****************************************************************************
 105          函数功能:写入显示数据到LCD子程序
 106          入口参数:dat
 107          出口参数:
 108          *****************************************************************************/
 109          void lcd_wdat(uchar dat)        
 110          {                                                       
 111   1              while(lcd_bz());                        //判断LCD是否忙碌
 112   1              rs = 1;
 113   1              rw = 0;
 114   1              ep = 0;
 115   1              P0 = dat;
 116   1              _nop_();
 117   1              _nop_();
C51 COMPILER V8.05a   CHENGXU                                                              04/17/2010 21:43:50 PAGE 3   

 118   1              _nop_();
 119   1              _nop_();
 120   1              ep = 1;
 121   1              _nop_();
 122   1              _nop_();
 123   1              _nop_();
 124   1              _nop_();
 125   1              ep = 0; 
 126   1      }
 127          
 128          /*****************************************************************************
 129          函数功能:LCD初始化子程序
 130          入口参数:
 131          出口参数:
 132          *****************************************************************************/
 133          void lcd_init()
 134          {                                                       
 135   1              lcd_wcmd(0x38);                 
 136   1              delay(1);
 137   1              lcd_wcmd(0x0c);         
 138   1              delay(1);
 139   1              lcd_wcmd(0x06);         
 140   1              delay(1);
 141   1              lcd_wcmd(0x01);                 
 142   1              delay(1);
 143   1      }
 144          
 145          /*****************************************************************************
 146          函数功能:主程序
 147          入口参数:
 148          出口参数:
 149          *****************************************************************************/
 150          void main(void)
 151          {
 152   1              
 153   1              uchar i;
 154   1              x=0;
 155   1              y=0;
 156   1              lcd_init();                                     // 初始化LCD                    
 157   1              delay(10);
 158   1              while(1)
 159   1              {
 160   2                      
 161   2                      if(P20==0)
 162   2                      {
 163   3                       x=0;
 164   3                       y=1;
 165   3                       
 166   3                      }
 167   2                      
 168   2                      if(P21==0)
 169   2                      {
 170   3                       x=1;
 171   3                       y=2;
 172   3                      
 173   3                      }
 174   2                      if(P22==0)
 175   2                      {
 176   3                       x=0;
 177   3                       y=4;
 178   3                      
 179   3                      }
C51 COMPILER V8.05a   CHENGXU                                                              04/17/2010 21:43:50 PAGE 4   

 180   2                      
 181   2                      lcd_pos(0x01);                          //设置显示位置
 182   2                      i = 0;
 183   2                      while(dis1[i] != '\0')
 184   2                      {                                                       
 185   3                              lcd_wdat(dis1[i]);              //显示字符
 186   3                              i++;
 187   3                      }
 188   2                      lcd_pos(0x46);                          // 设置显示位置
 189   2                      i = 0;
 190   2                      while(dis2[i] != '\0')
 191   2                      {
 192   3                      lcd_wdat(dis2[i]);              // 显示字符
 193   3                      i++;
 194   3                      }
 195   2                      lcd_pos(0x48);                          // 设置显示位置
 196   2                      lcd_wdat(dis4[x]);              // 显示字符
 197   2                      lcd_pos(0x49);                          // 设置显示位置
 198   2                      lcd_wdat(dis5[y]);              // 显示字符
 199   2                      /*lcd_pos(0x4A);                                // 设置显示位置
 200   2                      i = 0;
 201   2                      while(dis3[i] != '\0')
 202   2                      {
 203   2                      lcd_wdat(dis3[i]);              // 显示字符
 204   2                      i++;
 205   2                      } */
 206   2                      
 207   2              delay(5);
 208   2              //while(1);
 209   2              }                               
 210   1      }
 211          
 212          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    260    ----
   CONSTANT SIZE    =     48    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      2    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
