C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE 128643
OBJECT MODULE PLACED IN 128643.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE 128643.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /******************************************************************************
   2          Copyright 2007 
   3          All rights reserved.
   4          
   5          文件名 ： .c
   6          模块名称：st7920 并行方式驱动12864液晶驱动
   7          功能概要：st7920显示驱动
   8          完成日期：2007.07.08
   9          驱动芯片：st7920
  10          ******************************************************************************/
  11          #include <reg52.h>
  12          
  13          #define uint  unsigned int
  14          #define uchar unsigned char
  15          #define x1    0x80
  16          #define x2    0x88
  17          #define y     0x80
  18          #define comm  0
  19          #define dat   1
  20          
  21          sbit RS = P3^0;   //H=data; L="command";
  22          sbit RW = P3^1;   //H=read; L="write";
  23          sbit  E = P3^2;   //input enable;
  24          sbit PSB= P3^3;   //H=并口; L="串口";
  25          sbit RST= P3^5;   //Reset Signal 低电平有效
  26          
  27          sbit busy=P0^7;   //lcd busy bit
  28          
  29          void wr_lcd (uchar dat_comm,uchar content);
  30          void chk_busy (void);
  31          void delay (uint us);
  32          
  33          uchar code tab1[]={
  34          "欢迎你使用锐志电"
  35          "能实验板功能超强"
  36          "子的RZ-51PRO多功"
  37          "学习单片机的首选"
  38          };
  39          
  40          uchar code tab31[]={
  41          "欢迎光临锐志电子"
  42          "WWW.RICHMCU.COM"
  43          };
  44          uchar code tab32[]={
  45          /*--  调入了一幅图像：F:\梁\画图\HOCO12832.bmp  --*/
  46          /*--  宽度x高度=128x32  --*/
  47          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  48          0x00,0x1E,0x00,0x00,0x00,0x00,0x00,0x07,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  49          0x00,0x7F,0x80,0x00,0x00,0x00,0x00,0x18,0x0C,0x00,0x00,0x01,0x00,0x00,0x00,0x00,
  50          0x01,0xFF,0x80,0x00,0x00,0x00,0x00,0x20,0x00,0x00,0x00,0x13,0x10,0x03,0xFE,0x00,
  51          0x03,0xFF,0xC0,0x00,0x00,0x00,0x00,0x58,0x00,0x00,0x00,0x3F,0x30,0x1F,0xFF,0xC0,
  52          0x03,0xFF,0xE0,0x00,0x00,0x00,0x00,0x8C,0x03,0xF0,0x00,0x7F,0xE0,0x7C,0x01,0xE0,
  53          0x03,0xFF,0xF0,0x00,0x00,0x00,0x01,0x36,0x06,0xC0,0x00,0x5F,0xC0,0xFF,0xFC,0x60,
  54          0x01,0xFF,0xF0,0x00,0x00,0x00,0x02,0x1B,0x0F,0x80,0x00,0xFF,0x01,0xFE,0x0F,0x30,
  55          0x00,0xEF,0xF0,0x00,0x00,0x00,0x02,0x6D,0x9F,0x00,0x00,0x3E,0x03,0xFF,0xF1,0x90,
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 2   

  56          0x00,0xFF,0xF8,0x00,0x00,0x00,0x04,0x36,0xFE,0x00,0x01,0xFF,0x07,0xFF,0xFC,0x90,
  57          0x00,0xEF,0xFF,0xFF,0x80,0x00,0x04,0xDB,0x7E,0x00,0x03,0xFF,0x87,0xFF,0xFC,0xD0,
  58          0x00,0x0F,0xFF,0xFF,0xC0,0x00,0x04,0x6D,0xFC,0x00,0x07,0xFF,0x8F,0xFF,0xFE,0x50,
  59          0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x36,0xFC,0x10,0x07,0xFF,0x8F,0xFF,0xFE,0x90,
  60          0x00,0x0F,0xFF,0xFF,0xE0,0x00,0x04,0x1B,0xF8,0x10,0x07,0xFF,0xCF,0xFF,0xFE,0x80,
  61          0x00,0x0F,0xFF,0xFF,0xF0,0x00,0x04,0x0F,0xF8,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
  62          0x00,0x07,0xFF,0xFF,0xF0,0x00,0x04,0x07,0xF0,0x10,0x07,0xFF,0xFF,0xFF,0xFA,0x00,
  63          0x00,0xFF,0xFF,0xFF,0xF8,0x00,0x02,0x03,0xF0,0x20,0x07,0xFF,0xFF,0xFF,0xBA,0x00,
  64          0x00,0xFD,0xFF,0xFF,0xFC,0x00,0x02,0x03,0xF0,0x20,0x03,0xFF,0xFF,0xDF,0xB8,0x00,
  65          0x00,0xC1,0xC0,0x3F,0xFC,0x00,0x01,0x01,0xE0,0x40,0x00,0xFF,0xFF,0xDF,0xB0,0x00,
  66          0x00,0x81,0xC0,0x3F,0xCE,0x00,0x00,0x81,0xE0,0x80,0x00,0x7F,0xFF,0xDF,0xA0,0x00,
  67          0x00,0x81,0x80,0x1D,0xCF,0x00,0x00,0x41,0xE1,0x00,0x00,0x3F,0xFF,0x9B,0x00,0x00,
  68          0x01,0x83,0x80,0x1F,0xC7,0x80,0x00,0x21,0xE2,0x00,0x00,0x1F,0xFD,0xB6,0x00,0x00,
  69          0x01,0xC3,0x00,0x0E,0xE6,0x80,0x00,0x19,0xEC,0x00,0x00,0x07,0xFE,0x20,0x00,0x00,
  70          0x00,0xC3,0x00,0x07,0x67,0x40,0x00,0x07,0xF0,0x00,0x00,0x03,0x3E,0x00,0x00,0x00,
  71          0x00,0x02,0x00,0x03,0xE7,0xA0,0x00,0x00,0x00,0x00,0x00,0x02,0x8E,0x00,0x00,0x00,
  72          0x00,0x06,0x00,0x03,0x83,0x00,0x00,0x00,0x00,0x00,0x00,0x02,0x03,0x00,0x00,0x00,
  73          0x00,0x06,0x00,0x07,0x03,0x00,0x77,0x46,0x74,0x24,0x80,0x06,0x04,0x00,0x00,0x00,
  74          0x00,0x1C,0x00,0x06,0x00,0x00,0x55,0x45,0x54,0x57,0x80,0x00,0x00,0x00,0x00,0x00,
  75          0x00,0x1C,0x00,0x0E,0x00,0x00,0x45,0x45,0x74,0x57,0x80,0x08,0x00,0x00,0x00,0x00,
  76          0x00,0x00,0x00,0x1C,0x00,0x00,0x55,0x45,0x44,0x74,0x80,0xF0,0x00,0x00,0x00,0x00,
  77          0x00,0x00,0x00,0x38,0x00,0x00,0x77,0x76,0x47,0x54,0x80,0x00,0x00,0x00,0x00,0x00,
  78          0x00,0x00,0x00,0x00,0x00,0x00,0x10,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
  79          };
  80          
  81          uchar code tab5[]={
  82          /*--  调入了一幅图像：F:\梁\画图\COCK.bmp  --*/
  83          /*--  宽度x高度=128x64  --*/
  84          0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  85                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  86                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  87                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  88                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  89                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  90                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  91                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
  92                0x00,0x00,0x00,0x04,0x00,0xC0,0x00,0x38,
  93                0x00,0x00,0x30,0x00,0x00,0x69,0xC0,0x00,
  94                0x00,0x00,0x00,0x04,0x18,0xC0,0x00,0x18,
  95                0x00,0x00,0x30,0x00,0x01,0xFF,0xF0,0x00,
  96                0x00,0x00,0x00,0x0C,0x18,0xC0,0x0A,0xBD,
  97                0x50,0x1D,0x75,0xE0,0x01,0xC0,0xF0,0x00,
  98                0x00,0x74,0x00,0x3F,0x8C,0x80,0x1F,0xFF,
  99                0xF0,0x3F,0xFF,0xF0,0x00,0x0D,0xE0,0x00,
 100                0x03,0x8F,0x00,0xF0,0x3F,0xF0,0x30,0x18,
 101                0x00,0x18,0x30,0x60,0x00,0x07,0x00,0x00,
 102                0x0C,0x03,0x80,0xDF,0x30,0x70,0x00,0x38,
 103                0x00,0x1D,0x75,0x60,0x05,0x57,0x54,0x00,
 104                0x10,0x41,0x80,0x3E,0x30,0x20,0x07,0xFF,
 105                0xE0,0x1F,0xFF,0xE0,0x1F,0xFF,0xFF,0x80,
 106                0x21,0xC1,0xC0,0x04,0x3C,0xF0,0x02,0x08,
 107                0x00,0x18,0x30,0x60,0x3F,0x47,0xBF,0x80,
 108                0x40,0xC1,0x80,0x7F,0x9F,0xA0,0x02,0x19,
 109                0x80,0x1D,0x7F,0xE0,0x30,0x03,0x03,0x00,
 110                0xC1,0xC1,0x80,0x2E,0x05,0x80,0x27,0x99,
 111                0x80,0x0F,0xFF,0xE0,0x00,0x03,0x00,0x00,
 112                0x81,0x83,0x00,0x04,0x0D,0x00,0x33,0xE3,
 113                0x00,0x0C,0x70,0x00,0x00,0x03,0x00,0x00,
 114                0x81,0x86,0x00,0x0D,0x99,0x80,0x60,0x3E,
 115                0x00,0x00,0x38,0x01,0x00,0x07,0x00,0x00,
 116                0x81,0xBC,0x00,0x0F,0x39,0xC6,0xE0,0x0F,
 117                0xB6,0x00,0x3F,0xBF,0x00,0x07,0x00,0x00,
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 3   

 118                0x83,0xF0,0x00,0x1E,0xE0,0xFE,0xE0,0x03,
 119                0xFE,0x00,0x0F,0xFE,0x01,0xFF,0x00,0x00,
 120                0xC3,0x30,0x00,0x89,0x80,0x7C,0x00,0x01,
 121                0xF8,0x00,0x07,0xFC,0x00,0x7C,0x00,0x00,
 122                0x63,0x31,0xFF,0x00,0x00,0x00,0x00,0x00,
 123                0x20,0x00,0x00,0x50,0x00,0x00,0x00,0x00,
 124                0x63,0x19,0x12,0x00,0x00,0x00,0x00,0x00,
 125                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 126                0x07,0x19,0x04,0x3F,0xFF,0xFF,0xFF,0xFF,
 127                0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,
 128                0x07,0x19,0x88,0x3F,0xFF,0xFF,0xFF,0xFF,
 129                0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0x80,
 130                0x06,0x0C,0x10,0x00,0x00,0x00,0x00,0x00,
 131                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 132                0x0E,0x0C,0x20,0x00,0x00,0x00,0x00,0x00,
 133                0x08,0x00,0x00,0x00,0x00,0x40,0x00,0x00,
 134                0x3E,0x0E,0x40,0x0A,0x6D,0xB4,0x07,0x84,
 135                0x35,0x1A,0x67,0xA2,0x01,0xA7,0x9B,0x00,
 136                0x45,0x86,0x80,0x0A,0xAA,0xB4,0x04,0x44,
 137                0x26,0x92,0x68,0xA2,0x01,0x34,0x93,0x00,
 138                0x00,0x03,0x01,0x0E,0xAE,0xB4,0x04,0x44,
 139                0x61,0x1B,0x68,0xA2,0x01,0x0C,0x5B,0x00,
 140                0x00,0x07,0x03,0x0A,0xBA,0xD8,0x06,0x84,
 141                0x41,0xF2,0xC8,0x22,0x03,0x08,0xD7,0x00,
 142                0x00,0x07,0x87,0x0D,0x96,0x68,0x05,0x84,
 143                0x61,0x9B,0xE8,0x22,0x02,0x0C,0x5F,0x00,
 144                0x00,0x1F,0xF6,0x0D,0xB6,0x58,0x04,0x84,
 145                0x45,0x15,0xA8,0xA2,0x03,0x14,0xD5,0x00,
 146                0x00,0x10,0xFC,0x05,0x92,0x48,0x04,0x84,
 147                0x25,0x93,0xAC,0xA2,0x01,0x24,0x95,0x00,
 148                0x00,0x00,0x00,0x0D,0x96,0x49,0x04,0x44,
 149                0x3D,0x14,0xA7,0x1C,0x41,0xE7,0x15,0x00,
 150                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 151                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 152                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 153                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 154                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 155                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 156                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 157                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 158                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 159                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 160                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 161                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 162                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 163                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 164                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 165                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 166                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 167                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 168                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 169                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 170                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 171                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 172                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 173                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 174                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 175                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 176                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 177                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 178                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 179                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 4   

 180                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 181                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 182                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 183                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 184                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 185                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 186                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 187                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 188                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 189                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 190                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 191                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 192                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 193                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 194                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 195                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 196                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 197                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 198                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 199                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 200                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 201                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 202                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 203                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 204                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 205                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 206                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 207                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 208                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 209                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 210                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
 211                0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00
 212          };
 213          
 214          
 215          /******************************************************************************************
 216          * 函数名称    ：
 217          * 功能描述    ： 
 218          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 219          * 
 220          * 返回值      ：
 221          * 作者        ：
 222          * 创建日期    ：2006-12-19
 223          * 全局变量    ：
 224          * 全局静态变量：
 225          * 局部静态变量：
 226          *----------------------------------------修改历史------------------------------------------
 227          * 当前版本    ：     修改人：                  修改日期：
 228          * 修改说明    ：
 229          ******************************************************************************************/
 230          void init_lcd (void)
 231          {
 232   1         RST = 1;
 233   1         PSB = 1;
 234   1         wr_lcd(comm,0x30);  /*30---基本指令动作*/   
 235   1         wr_lcd(comm,0x01);  /*清屏，地址指针指向00H*/
 236   1         wr_lcd(comm,0x06);  /*光标的移动方向*/
 237   1         wr_lcd(comm,0x0c);  /*开显示，关游标*/
 238   1      }
 239          
 240          /******************************************************************************************
 241          * 函数名称    ：chn_disp
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 5   

 242          * 功能描述    ： 显示汉字或字符
 243          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 244          * 
 245          * 返回值      ：
 246          * 作者        ：
 247          * 创建日期    ：2006-12-19
 248          * 全局变量    ：
 249          * 全局静态变量：
 250          * 局部静态变量：
 251          *----------------------------------------修改历史------------------------------------------
 252          * 当前版本    ：     修改人：                  修改日期：
 253          * 修改说明    ：
 254          ******************************************************************************************/
 255          void chn_disp(uchar code *chn)
 256          {
 257   1         uchar i,j;
 258   1         wr_lcd(comm,0x30);
 259   1         wr_lcd(comm,0x80);
 260   1         for(j=0;j<4;j++)
 261   1         {
 262   2           for(i=0;i<16;i++)
 263   2           wr_lcd(dat,chn[j*16+i]);
 264   2         }
 265   1      }
 266          
 267          /******************************************************************************************
 268          * 函数名称    ：chn_disp1
 269          * 功能描述    ： 上半屏显示汉字或字符
 270          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 271          * 
 272          * 返回值      ：
 273          * 作者        ：
 274          * 创建日期    ：2006-12-19
 275          * 全局变量    ：
 276          * 全局静态变量：
 277          * 局部静态变量：
 278          *----------------------------------------修改历史------------------------------------------
 279          * 当前版本    ：     修改人：                  修改日期：
 280          * 修改说明    ：
 281          ******************************************************************************************/
 282          void chn_disp1(uchar code *chn)
 283          {
 284   1         uchar i,j;
 285   1         wr_lcd(comm,0x30);
 286   1         wr_lcd(comm,0x80);
 287   1         j=0;
 288   1         for(i=0;i<16;i++)
 289   1         wr_lcd(dat,chn[j*16+i]);
 290   1         wr_lcd(comm,0x90);
 291   1         j=1;
 292   1         for(i=0;i<16;i++)
 293   1         wr_lcd(dat,chn[j*16+i]);
 294   1      }
 295          
 296          /******************************************************************************************
 297          * 函数名称    ：img_disp
 298          * 功能描述    ： 显示图形
 299          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 300          * 
 301          * 返回值      ：
 302          * 作者        ：
 303          * 创建日期    ：2006-12-19
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 6   

 304          * 全局变量    ：
 305          * 全局静态变量：
 306          * 局部静态变量：
 307          *----------------------------------------修改历史------------------------------------------
 308          * 当前版本    ：     修改人：                  修改日期：
 309          * 修改说明    ：
 310          ******************************************************************************************/
 311          void img_disp(uchar code *img)
 312          {
 313   1         uchar i,j;
 314   1         for(j=0;j<32;j++)
 315   1         {
 316   2           for(i=0;i<8;i++)
 317   2           {
 318   3             wr_lcd(comm,0x34);
 319   3             wr_lcd(comm,y+j);
 320   3             wr_lcd(comm,x1+i);
 321   3             wr_lcd(comm,0x30);
 322   3             wr_lcd(dat,img[j*16+i*2]);
 323   3             wr_lcd(dat,img[j*16+i*2+1]);
 324   3           }
 325   2         }
 326   1         for(j=32;j<64;j++)
 327   1         {
 328   2           for(i=0;i<8;i++)
 329   2           {
 330   3             wr_lcd(comm,0x34);
 331   3             wr_lcd(comm,y+j-32);
 332   3             wr_lcd(comm,x2+i);
 333   3             wr_lcd(comm,0x30);
 334   3             wr_lcd(dat,img[j*16+i*2]);
 335   3             wr_lcd(dat,img[j*16+i*2+1]);
 336   3           }
 337   2         }
 338   1         wr_lcd (comm,0x36);
 339   1      }
 340          
 341          /******************************************************************************************
 342          * 函数名称    ：img_disp1
 343          * 功能描述    ： 下半屏显示图形
 344          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 345          * 
 346          * 返回值      ：
 347          * 作者        ：
 348          * 创建日期    ：2006-12-19
 349          * 全局变量    ：
 350          * 全局静态变量：
 351          * 局部静态变量：
 352          *----------------------------------------修改历史------------------------------------------
 353          * 当前版本    ：     修改人：                  修改日期：
 354          * 修改说明    ：
 355          ******************************************************************************************/
 356          void img_disp1(uchar code *img)
 357          {
 358   1         uchar i,j;
 359   1         for(j=0;j<32;j++)
 360   1         {
 361   2           for(i=0;i<8;i++)
 362   2           {
 363   3             wr_lcd(comm,0x34);
 364   3             wr_lcd(comm,y+j);
 365   3             wr_lcd(comm,x2+i);
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 7   

 366   3             wr_lcd(comm,0x30);
 367   3             wr_lcd(dat,img[j*16+i*2]);
 368   3             wr_lcd(dat,img[j*16+i*2+1]);
 369   3           }
 370   2         }
 371   1         wr_lcd(comm,0x36);
 372   1      }
 373          
 374          /******************************************************************************************
 375          * 函数名称    ：lat_disp
 376          * 功能描述    ： 显示点阵
 377          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 378          * 
 379          * 返回值      ：
 380          * 作者        ：
 381          * 创建日期    ：2006-12-19
 382          * 全局变量    ：
 383          * 全局静态变量：
 384          * 局部静态变量：
 385          *----------------------------------------修改历史------------------------------------------
 386          * 当前版本    ：     修改人：                  修改日期：
 387          * 修改说明    ：
 388          ******************************************************************************************/
 389          void lat_disp(uchar data1,uchar data2)
 390          {
 391   1         uchar i,j,k,x;
 392   1         x=x1;
 393   1         for(k=0;k<2;k++)
 394   1         {
 395   2           for(j=0;j<16;j++)
 396   2           {
 397   3             for(i=0;i<8;i++)
 398   3             {
 399   4               wr_lcd(comm,0x34);
 400   4                wr_lcd(comm,y+j*2);
 401   4               wr_lcd(comm,x+i);
 402   4               wr_lcd(comm,0x30);
 403   4               wr_lcd(dat,data1);
 404   4               wr_lcd(dat,data1);
 405   4             }
 406   3             for(i=0;i<8;i++)
 407   3             {
 408   4               wr_lcd(comm,0x34);
 409   4               wr_lcd(comm,y+j*2+1);
 410   4               wr_lcd(comm,x+i);
 411   4               wr_lcd(comm,0x30);
 412   4               wr_lcd(dat,data2);
 413   4               wr_lcd(dat,data2);
 414   4             }
 415   3           }
 416   2           x=x2;
 417   2         }
 418   1         wr_lcd(comm,0x36);
 419   1      }
 420          
 421          /******************************************************************************************
 422          * 函数名称    ：con_disp
 423          * 功能描述    ： 当data1=0xff,data2=0xff时,在x0,y0处反白显示16xl*yl
 424          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 425          * 
 426          * 返回值      ：
 427          * 作者        ：
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 8   

 428          * 创建日期    ：2006-12-19
 429          * 全局变量    ：
 430          * 全局静态变量：
 431          * 局部静态变量：
 432          *----------------------------------------修改历史------------------------------------------
 433          * 当前版本    ：     修改人：                  修改日期：
 434          * 修改说明    ：
 435          ******************************************************************************************/
 436          void con_disp(uchar data1,uchar data2,uchar x0,uchar y0,uchar xl,uchar yl)
 437          {
 438   1         uchar i,j;
 439   1         for(j=0;j<yl;j++)
 440   1         {
 441   2           for(i=0;i<xl;i++)
 442   2           {
 443   3             wr_lcd(comm,0x34);
 444   3             wr_lcd(comm,y0+j);
 445   3             wr_lcd(comm,x0+i);
 446   3             wr_lcd(comm,0x30);
 447   3             wr_lcd(dat,data1);
 448   3             wr_lcd(dat,data2);
 449   3           }
 450   2         }
 451   1         wr_lcd(comm,0x36);
 452   1      }
 453          
 454          /******************************************************************************************
 455          * 函数名称    ：clrram
 456          * 功能描述    ： 清DDRAM
 457          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 458          * 
 459          * 返回值      ：
 460          * 作者        ：
 461          * 创建日期    ：2006-12-19
 462          * 全局变量    ：
 463          * 全局静态变量：
 464          * 局部静态变量：
 465          *----------------------------------------修改历史------------------------------------------
 466          * 当前版本    ：     修改人：                  修改日期：
 467          * 修改说明    ：
 468          ******************************************************************************************/
 469          void clrram(void)
 470          {
 471   1         wr_lcd(comm,0x30);
 472   1         wr_lcd(comm,0x01);
 473   1      }
 474          
 475          /******************************************************************************************
 476          * 函数名称    ：wr_lcd
 477          * 功能描述    ： 
 478          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 479          * 
 480          * 返回值      ：
 481          * 作者        ：
 482          * 创建日期    ：2006-12-19
 483          * 全局变量    ：
 484          * 全局静态变量：
 485          * 局部静态变量：
 486          *----------------------------------------修改历史------------------------------------------
 487          * 当前版本    ：     修改人：                  修改日期：
 488          * 修改说明    ：
 489          ******************************************************************************************/
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 9   

 490          void wr_lcd(uchar dat_comm,uchar content)
 491          {
 492   1         chk_busy ();
 493   1         if(dat_comm)
 494   1          {
 495   2           RS = 1;   //data
 496   2           RW = 0;   //write
 497   2          }
 498   1         else 
 499   1          {
 500   2           RS = 0;   //command
 501   2           RW = 0;   //write
 502   2          }
 503   1         P0=content;   //output data or comm
 504   1         E = 1;
 505   1         ;
 506   1         E = 0;
 507   1      }
 508          /******************************************************************************************
 509          * 函数名称    ：chk_busy
 510          * 功能描述    ： 
 511          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 512          * 
 513          * 返回值      ：
 514          * 作者        ：
 515          * 创建日期    ：2006-12-19
 516          * 全局变量    ：
 517          * 全局静态变量：
 518          * 局部静态变量：
 519          *----------------------------------------修改历史------------------------------------------
 520          * 当前版本    ：     修改人：                  修改日期：
 521          * 修改说明    ：
 522          ******************************************************************************************/
 523          void chk_busy(void)
 524          {
 525   1         P0 = 0xff;
 526   1         RS = 0;
 527   1         RW = 1;
 528   1         E = 1;
 529   1         while(busy==1);
 530   1         E = 0;
 531   1      }
 532          /******************************************************************************************
 533          * 函数名称    ：
 534          * 功能描述    ： 
 535          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 536          * 
 537          * 返回值      ：
 538          * 作者        ：
 539          * 创建日期    ：2006-12-19
 540          * 全局变量    ：
 541          * 全局静态变量：
 542          * 局部静态变量：
 543          *----------------------------------------修改历史------------------------------------------
 544          * 当前版本    ：     修改人：                  修改日期：
 545          * 修改说明    ：
 546          ******************************************************************************************/
 547          void delay(uint us)   //delay time
 548          {
 549   1         while(us--);
 550   1      }
 551          /******************************************************************************************
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 10  

 552          * 函数名称    ：
 553          * 功能描述    ： 
 554          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 555          * 
 556          * 返回值      ：
 557          * 作者        ：
 558          * 创建日期    ：2006-12-19
 559          * 全局变量    ：
 560          * 全局静态变量：
 561          * 局部静态变量：
 562          *----------------------------------------修改历史------------------------------------------
 563          * 当前版本    ：     修改人：                  修改日期：
 564          * 修改说明    ：
 565          ******************************************************************************************/
 566          void delay1(uint ms)
 567          {
 568   1         uint i,j;
 569   1         for(i=0;i<ms;i++)
 570   1         for(j=0;j<15;j++)
 571   1         delay(1);
 572   1      }
 573          
 574          /******************************************************************************************
 575          * 函数名称    ：
 576          * 功能描述    ： 
 577          * 参数        ：  参数名称： 输入/输出？ 类型  描述
 578          * 
 579          * 返回值      ：
 580          * 作者        ：
 581          * 创建日期    ：2006-12-19
 582          * 全局变量    ：
 583          * 全局静态变量：
 584          * 局部静态变量：
 585          *----------------------------------------修改历史------------------------------------------
 586          * 当前版本    ：     修改人：                  修改日期：
 587          * 修改说明    ：
 588          ******************************************************************************************/
 589          void main()
 590          {
 591   1         SP=0x5f;
 592   1         init_lcd();
 593   1         while(1)
 594   1         {
 595   2           lat_disp(0x00,0x00);
 596   2           chn_disp(tab1);
 597   2           con_disp(0xff,0xff,0x8c,0x80,2,16);
 598   2           delay1(8000);
 599   2           clrram();
 600   2           //lat_disp(0xcc,0xcc);
 601   2           //delay1(8000);
 602   2           lat_disp(0x00,0x00);
 603   2           chn_disp1(tab31);
 604   2           img_disp1(tab32);
 605   2           delay1 (8000);
 606   2           clrram();
 607   2           //lat_disp (0xff,0x00);
 608   2          //delay1(8000);
 609   2           img_disp(tab5);
 610   2           delay1(8000);
 611   2         }
 612   1      }
 613          
C51 COMPILER V8.02   128643                                                                10/15/2007 18:04:03 PAGE 11  

 614          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1020    ----
   CONSTANT SIZE    =   1633    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      34
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
