/*
 ----------------------------------------------------
 *作    者：温子祺
 ----------------------------------------------------
 */
#include "stc.h"            //加载"stc.h"
/****************************************
*函数名称:UARTInit
*输    入:无
*输    出:无
*功    能:串口初始化
******************************************/
void UARTInit(void)       //定义串口初始化函数
{
    SCON =0x50;             //8位数据位
	T2CON=0x34;             //由T/C2作为波特率发生器
	RCAP2L=0xD9;            //波特率为9600的低8位
	RCAP2H=0xFF;            //波特率为9600的高8位
	ES=1;                     //允许串口中断                   
	EA=1;                     //允许全局中断
}
/****************************************
*函数名称:UARTSendByte
*输    入:byte 要发送的字节
*输    出:无
*功    能:串口发送单个字节
******************************************/
void UARTSendByte(unsigned char byte)
{
	SBUF=byte;                //缓冲区装载要发送的字节
	while(TI==0);            //等待发送完毕,TI会置1
	TI=0;                      //清零TI
} 
/****************************************
*函数名称:main
*输    入:无
*输    出:无
*功    能:函数主体
******************************************/
void main(void)              //主函数
{
    UARTInit();              //串口初始化
	while(1)                  //进入死循环
	{;}                        //无操作
}
/****************************************
*函数名称:UartIRQ
*输    入:无
*输    出:无
*功    能:串口中断服务函数
******************************************/
void UartIRQ(void) interrupt 4
{
     unsigned char recv;      //声明变量recv

	if(RI)                      //检测RI是否置1
	{
		RI=0;                    //清零RI
		recv=SBUF;              //读取接收到的数据
		UARTSendByte(recv);   //返发接收到的数据
	}
}

