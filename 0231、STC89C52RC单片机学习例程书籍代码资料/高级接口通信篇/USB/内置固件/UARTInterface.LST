C51 COMPILER V7.06   UARTINTERFACE                                                         04/20/2010 16:12:20 PAGE 1   


C51 COMPILER V7.06, COMPILATION OF MODULE UARTINTERFACE
OBJECT MODULE PLACED IN .\Output\UARTInterface.obj
COMPILER INVOKED BY: C:\Program Files\Keil\C51\BIN\C51.EXE UARTInterface.c BROWSE DEBUG OBJECTEXTEND OBJECT(.\Output\UAR
                    -TInterface.obj)

stmt level    source

   1          /************************************************************************
   2          *作    者:温子祺 邮箱:k125008301@126.com
   3          *文    件:UARTInterface.c
   4          --------------------------------------------------------------
   5          *说    明:定义串口硬件接口层
   6          *修改日期:2009/12/02
   7          --------------------------------------------------------------
   8          *创建日期:2009/11/30
   9          *说    明:
  10          --------------------------------------------------------------
  11          *************************************************************************/
  12          #include "stc.h"
  13          #include "global.h"
  14          #include "UARTHardware.h"
  15          #include "UARTInterface.h"
  16          /****************************************************************************************************
  17          *
  18          *                                      变量区
  19          * 
  20          *****************************************************************************************************/
  21          
  22          
  23          /****************************************************************************************************
  24          *
  25          *                                      函数区
  26          * 
  27          *****************************************************************************************************/
  28          /******************************************************************
  29          *函数名称:UARTSendByte
  30          *输    入:b
  31          *输    出:无
  32          *说    明:串口 发送单字节
  33          *******************************************************************/
  34          static
  35          void UARTSendByte(UINT8 b)
  36          {
  37   1               SBUF=b;
  38   1               while(TI==0);
  39   1               TI=0;
  40   1      }
  41          /******************************************************************
  42          *函数名称:UARTSendByte
  43          *输    入:b
  44          *输    出:无
  45          *说    明:串口 发送单字节
  46          *******************************************************************/
  47          void UARTCiSendNBytes(UINT8 *buf,UINT8 len)
  48          {
  49   1               if(buf == NULL || len ==0 )return;
  50   1      
  51   1           while(len--)
  52   1           {
  53   2              UARTSendByte(*buf++);
  54   2           }
C51 COMPILER V7.06   UARTINTERFACE                                                         04/20/2010 16:12:20 PAGE 2   

  55   1      }
  56          /******************************************************************
  57          *函数名称:UARTCiPrintfString
  58          *输    入:b
  59          *输    出:无
  60          *说    明:串口 发送字符串
  61          *******************************************************************/
  62          void UARTCiPrintfString(const INT8 *str)
  63          {
  64   1           while(str && *str)
  65   1           {
  66   2           
  67   2              UARTSendByte(*str++); 
  68   2                     
  69   2           }
  70   1      
  71   1      }
  72          /******************************************************************
  73          *函数名称:UARTSendByte
  74          *输    入:b
  75          *输    出:无
  76          *说    明:串口 发送单字节
  77          *******************************************************************/
  78          void UARTCiPrintfVal(UINT8 *str,UINT32 val,UINT8 show)
  79          {    
  80   1           UINT8 i=0;
  81   1           UINT8 buf[10]={0}; 
  82   1           
  83   1               UARTCiPrintfString(str);
  84   1      
  85   1           if(10 == show)
  86   1           {
  87   2               for(i=0; i<10 ;i++)
  88   2               {
  89   3                   buf[i]=(UINT8)('0'+val%10);   
  90   3                   val/=10;   
  91   3               } 
  92   2           
  93   2               
  94   2               for(i=9;i>=0;)
  95   2               {
  96   3                   if('0' == buf[i])
  97   3                   {
  98   4                       i--;
  99   4                   }
 100   3                   else
 101   3                   {
 102   4                      break;
 103   4                   }
 104   3               } 
 105   2               
 106   2               while(1)
 107   2               {    
 108   3                   
 109   3                   UARTSendByte(buf[i]); 
 110   3                   
 111   3                   if(!i)
 112   3                   {
 113   4                       break; 
 114   4                   } 
 115   3                   
 116   3                   i--;
C51 COMPILER V7.06   UARTINTERFACE                                                         04/20/2010 16:12:20 PAGE 3   

 117   3               } 
 118   2               
 119   2               
 120   2           }
 121   1           
 122   1           if(16 == show)
 123   1           {
 124   2              UARTSendByte('0');
 125   2                  UARTSendByte('x');
 126   2                  
 127   2              i=28;
 128   2              
 129   2              while(i)
 130   2              {
 131   3                  if(0  == ((val>>i) &0x0f))
 132   3                  {   
 133   4                      i=i-4;
 134   4                     
 135   4                  }
 136   3                  else
 137   3                  {
 138   4                      break;
 139   4                  }
 140   3              } 
 141   2              
 142   2              while(1)
 143   2              {
 144   3                  UARTSendByte(HexTable[(val>>i) &0x0f]); 
 145   3                  
 146   3                  if(!i)
 147   3                  {
 148   4                      break; 
 149   4                  }     
 150   3                          
 151   3                  i=i-4;
 152   3              }  
 153   2              
 154   2           } 
 155   1           
 156   1           UARTCiPrintfString("\r\n");
 157   1      }
 158          /******************************************************************
 159          *函数名称:UARTCiInit
 160          *输    入:无
 161          *输    出:无
 162          *说    明:串口 初始化
 163          *******************************************************************/
 164          void UARTCiInit(void)
 165          {
 166   1              UARTHwInit();
 167   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    362    ----
   CONSTANT SIZE    =     13    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      25
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V7.06   UARTINTERFACE                                                         04/20/2010 16:12:20 PAGE 4   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
